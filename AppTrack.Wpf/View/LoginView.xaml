<Window
    x:Class="AppTrack.WpfUi.View.LoginView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converter="clr-namespace:AppTrack.WpfUi.Converter"
    xmlns:helpers="clr-namespace:AppTrack.WpfUi.Helpers"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    Title="AppTrack Login"
    SizeToContent="WidthAndHeight"
    WindowStartupLocation="CenterOwner">
    <Window.Resources>
        <converter:ErrorsDictionaryConverter x:Key="ErrorsDictConverter" />
        <converter:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </Window.Resources>
    <StackPanel Width="250" Margin="20">
        <!--  UserName  -->
        <TextBlock Text="Username:" />
        <StackPanel>
            <TextBox Text="{Binding Model.UserName}">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="TextChanged">
                        <i:InvokeCommandAction Command="{Binding ResetErrorsCommand}" CommandParameter="UserName" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </TextBox>
            <ItemsControl ItemsSource="{Binding Errors, Converter={StaticResource ErrorsDictConverter}, ConverterParameter=UserName}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <TextBlock
                            FontSize="12"
                            Foreground="Red"
                            Text="{Binding}"
                            TextWrapping="Wrap" />
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>
        <!--  Password  -->
        <TextBlock Margin="0,10,0,0" Text="Password:" />
        <StackPanel>
            <PasswordBox
                x:Name="PasswordBox"
                helpers:PasswordBoxHelper.BoundPassword="{Binding Model.Password}"
                Visibility="{Binding IsPasswordVisible, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=False}">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="PasswordChanged">
                        <i:InvokeCommandAction Command="{Binding ResetErrorsCommand}" CommandParameter="Password" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </PasswordBox>
            <TextBox Text="{Binding Model.Password, Mode=TwoWay}" Visibility="{Binding IsPasswordVisible, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=True}" />
            <ItemsControl ItemsSource="{Binding Errors, Converter={StaticResource ErrorsDictConverter}, ConverterParameter=Password}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <TextBlock
                            FontSize="12"
                            Foreground="Red"
                            Text="{Binding}"
                            TextWrapping="Wrap" />
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>
        <!--  Checkboxes  -->
        <StackPanel>
            <CheckBox Margin="0,5" IsChecked="{Binding IsRememberMeChecked}">
                <TextBlock FontSize="12" Text="Remember me" />
            </CheckBox>
            <CheckBox Margin="0,5" IsChecked="{Binding IsPasswordVisible}">
                <TextBlock FontSize="12" Text="Show password" />
            </CheckBox>
        </StackPanel>
        <!--  Message  -->
        <TextBlock
            FontSize="12"
            Foreground="Red"
            Text="{Binding ErrorMessage}"
            TextWrapping="Wrap" />
        <!--  Buttons  -->
        <Button
            Margin="0,20,0,0"
            Command="{Binding SaveCommand}"
            CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
            Content="Login" />
        <Button
            Margin="0,20,0,0"
            Command="{Binding RegisterCommand}"
            Content="Register" />
    </StackPanel>
</Window>